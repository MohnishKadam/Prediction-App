<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinGecko Crypto Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .api-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .control-group:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .control-group h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        input, select, button {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }

        .error {
            background: #ffe6e6;
            color: #d32f2f;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #d32f2f;
        }

        .data-display {
            margin-top: 30px;
        }

        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .crypto-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .crypto-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .crypto-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .crypto-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .crypto-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .crypto-name {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .crypto-symbol {
            color: #666;
            text-transform: uppercase;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .crypto-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .detail-item {
            padding: 8px 0;
        }

        .detail-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 2px;
        }

        .detail-value {
            font-weight: 600;
            color: #333;
        }

        .price-positive {
            color: #4caf50;
        }

        .price-negative {
            color: #f44336;
        }

        .json-display {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .api-controls {
                grid-template-columns: 1fr;
            }
            
            .crypto-grid {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
       <div class="header" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
        <h1>üöÄ CoinGecko Crypto Dashboard</h1>
        <p>Real-time cryptocurrency data at your fingertips</p>
    </div>
    <div>
        <h3 style="color: #333;">üíº Wallet Balance: $<span id="wallet-balance">10000</span></h3>
    </div>
</div>


        <div class="tabs">
            <button class="tab active" onclick="switchTab('market', event)">Market Data</button>
            <button class="tab" onclick="switchTab('search', event)">Search Coins</button>
            <button class="tab" onclick="switchTab('trending', event)">Trending</button>
            <button class="tab" onclick="switchTab('global', event)">Global Stats</button>
            <button class="tab" onclick="switchTab('wallet', event)">Wallet</button>
            <button class="tab" onclick="switchTab('prediction', event)">Prediction</button>
            <button class="tab" onclick="switchTab('charts', event)">Charts</button>
        </div>
<div id="wallet-tab" class="tab-content">
    <div class="api-controls">
        <div class="control-group">
            <h3>üíº Wallet Holdings</h3>
            <div class="input-group">
                <button onclick="renderWallet()">Refresh Wallet Info</button>
            </div>
            <div id="wallet-table-container"></div>
        </div>
    </div>
</div>

        <div id="market-tab" class="tab-content active">
            <div class="api-controls">
                <div class="control-group">
                    <h3>üìä Market Data</h3>
                    <div class="input-group">
                        <select id="currency">
                            <option value="usd">USD</option>
                            <option value="eur">EUR</option>
                            <option value="btc">BTC</option>
                            <option value="eth">ETH</option>
                        </select>
                        <input type="number" id="per-page" placeholder="Results (1-250)" value="10" min="1" max="250">
                        <button onclick="fetchMarketData()">Get Market Data</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="search-tab" class="tab-content">
            <div class="api-controls">
                <div class="control-group">
                    <h3>üîç Search Cryptocurrencies</h3>
                    <div class="input-group">
                        <input type="text" id="search-query" placeholder="Enter coin name or symbol">
                        <button onclick="searchCoins()">Search</button>
                    </div>
                </div>
                <div class="control-group">
                    <h3>üí∞ Get Specific Coin Data</h3>
                    <div class="input-group">
                        <input type="text" id="coin-id" placeholder="Coin ID (e.g., bitcoin, ethereum)">
                        <button onclick="getCoinData()">Get Details</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="trending-tab" class="tab-content">
            <div class="api-controls">
                <div class="control-group">
                    <h3>üî• Trending Cryptocurrencies</h3>
                    <div class="input-group">
                        <button onclick="fetchTrending()">Get Trending Coins</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="prediction-tab" class="tab-content">
    <div class="api-controls">
        <div class="control-group">
            <h3>ü§ñ Predict Crypto Movement</h3>
            <div class="input-group">
                <input type="text" id="predict-coin-id" placeholder="Enter coin ID (e.g., bitcoin)">
                <button onclick="predictFromInput()">Predict</button>
            </div>
            <div id="prediction-result" class="json-display" style="margin-top: 20px; display: none;"></div>
        </div>
    </div>
</div>


<div id="charts-tab" class="tab-content" style="min-height: 600px;">
    <div class="api-controls">
        <div class="control-group">
            <h3>üìâ View Real-Time Charts</h3>
            
<div class="input-group">
    <select id="tv-symbol-select" onchange="loadTradingViewChart(this.value)">
        <option value="BINANCE:BTCUSDT">Bitcoin (BTC)</option>
        <option value="BINANCE:ETHUSDT">Ethereum (ETH)</option>
        <option value="BINANCE:ADAUSDT">Cardano (ADA)</option>
        <option value="BINANCE:XRPUSDT">Ripple (XRP)</option>
        <option value="BINANCE:DOGEUSDT">Dogecoin (DOGE)</option>
        <option value="BINANCE:MATICUSDT">Polygon (MATIC)</option>
    </select>
</div>

            <div id="tradingview-container" style="margin-top: 20px;">
                <div id="tv-chart" style="height: 600px;"></div>
            </div>
        </div>
    </div>
</div>

        <div id="global-tab" class="tab-content">
            <div class="api-controls">
                <div class="control-group">
                    <h3>üåç Global Market Statistics</h3>
                    <div class="input-group">
                        <button onclick="fetchGlobalStats()">Get Global Data</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div>‚è≥ Loading crypto data...</div>
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="data-display" class="data-display"></div>
        <div class="api-controls">
    <div class="control-group">
        <h3>üíº Dummy Wallet</h3>
        <div class="input-group">
            <select id="wallet-coin">
                <option value="bitcoin">Bitcoin</option>
                <option value="ethereum">Ethereum</option>
                <option value="cardano">Cardano</option>
                <option value="ripple">Ripple (XRP)</option>
                <option value="tether">Tether (USDT)</option>
                <option value="binancecoin">BNB (Binance Coin)</option>
                <option value="solana">Solana (SOL)</option>
            </select>
            <input type="number" id="wallet-amount" placeholder="Quantity to buy/sell">
            <button onclick="buyCoin()">Buy</button>
            <button onclick="sellCoin()">Sell</button>
        </div>
        <p><strong>Balance:</strong> $<span id="wallet-balance">10000</span></p>
        <p><strong>Holdings:</strong> <pre id="wallet-holdings">{}</pre></p>
    </div>
</div>

    </div>

    <script>
        const API_KEY = 'CG-C9MWDmLXa1Dd4yxxTvAWtMdz';
        const BASE_URL = 'https://api.coingecko.com/api/v3';

        function switchTab(tabName , event) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Clear previous results
            document.getElementById('data-display').innerHTML = '';
            if (tabName === 'wallet') renderWallet();

        }

        async function makeApiCall(endpoint) {
            showLoading();
            hideError();
            
            try {
                const response = await fetch(`${BASE_URL}${endpoint}`, {
                    headers: {
                        'x-cg-demo-api-key': API_KEY
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                hideLoading();
                return data;
            } catch (error) {
                hideLoading();
                showError(`Error fetching data: ${error.message}`);
                return null;
            }
        }

        async function fetchMarketData() {
            const currency = document.getElementById('currency').value;
            const perPage = document.getElementById('per-page').value || 10;
            
            const data = await makeApiCall(`/coins/markets?vs_currency=${currency}&order=market_cap_desc&per_page=${perPage}&page=1&sparkline=false`);
            
            if (data) {
                displayMarketData(data, currency);
            }
        }

        async function searchCoins() {
            const query = document.getElementById('search-query').value.trim();
            if (!query) {
                showError('Please enter a search query');
                return;
            }
            
            const data = await makeApiCall(`/search?query=${encodeURIComponent(query)}`);
            
            if (data) {
                displaySearchResults(data);
            }
        }

        async function getCoinData() {
            const coinId = document.getElementById('coin-id').value.trim();
            if (!coinId) {
                showError('Please enter a coin ID');
                return;
            }
            
            const data = await makeApiCall(`/coins/${coinId}?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=false`);
            
            if (data) {
                displayCoinDetails(data);
            }
        }

        async function fetchTrending() {
            const data = await makeApiCall('/search/trending');
            
            if (data) {
                displayTrendingData(data);
            }
        }

        async function fetchGlobalStats() {
            const data = await makeApiCall('/global');
            
            if (data) {
                displayGlobalStats(data);
            }
        }

        function displayMarketData(data, currency) {
            const container = document.getElementById('data-display');
            const currencySymbol = currency === 'usd' ? '$' : currency.toUpperCase();
            
            container.innerHTML = `
                <h2>üìà Top Cryptocurrencies by Market Cap</h2>
                <div class="crypto-grid">
                    ${data.map(coin => `
                        <div class="crypto-card">
                            <div class="crypto-header">
                                <img src="${coin.image}" alt="${coin.name}" class="crypto-icon">
                                <div>
                                    <div class="crypto-name">${coin.name}</div>
                                    <span class="crypto-symbol">${coin.symbol}</span>
                                </div>
                            </div>
                            <div class="crypto-details">
                                <div class="detail-item">
                                    <div class="detail-label">Current Price</div>
                                    <div class="detail-value">${currencySymbol}${coin.current_price?.toLocaleString() || 'N/A'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">24h Change</div>
                                    <div class="detail-value ${coin.price_change_percentage_24h >= 0 ? 'price-positive' : 'price-negative'}">
                                        ${coin.price_change_percentage_24h?.toFixed(2) || 'N/A'}%
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Market Cap</div>
                                    <div class="detail-value">${currencySymbol}${coin.market_cap?.toLocaleString() || 'N/A'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Volume (24h)</div>
                                    <div class="detail-value">${currencySymbol}${coin.total_volume?.toLocaleString() || 'N/A'}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displaySearchResults(data) {
            const container = document.getElementById('data-display');
            
            container.innerHTML = `
                <h2>üîç Search Results</h2>
                <div class="crypto-grid">
                    ${data.coins.slice(0, 12).map(coin => `
                        <div class="crypto-card">
                            <div class="crypto-header">
                                <img src="${coin.large || coin.thumb}" alt="${coin.name}" class="crypto-icon">
                                <div>
                                    <div class="crypto-name">${coin.name}</div>
                                    <span class="crypto-symbol">${coin.symbol}</span>
                                </div>
                            </div>
                            <div class="crypto-details">
                                <div class="detail-item">
                                    <div class="detail-label">ID</div>
                                    <div class="detail-value">${coin.id}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Market Cap Rank</div>
                                    <div class="detail-value">#${coin.market_cap_rank || 'N/A'}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displayCoinDetails(coin) {
    predictCoinMovement(coin);

            const container = document.getElementById('data-display');
            
            container.innerHTML = `
                <h2>üí∞ ${coin.name} Details</h2>
                <div class="crypto-grid">
                    <div class="crypto-card" style="grid-column: 1 / -1;">
                        <div class="crypto-header">
                            <img src="${coin.image.large}" alt="${coin.name}" class="crypto-icon">
                            <div>
                                <div class="crypto-name">${coin.name}</div>
                                <span class="crypto-symbol">${coin.symbol}</span>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                            <div class="detail-item">
                                <div class="detail-label">Current Price (USD)</div>
                                <div class="detail-value">$${coin.market_data.current_price.usd?.toLocaleString() || 'N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Market Cap Rank</div>
                                <div class="detail-value">#${coin.market_cap_rank || 'N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Market Cap</div>
                                <div class="detail-value">$${coin.market_data.market_cap.usd?.toLocaleString() || 'N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">24h Volume</div>
                                <div class="detail-value">$${coin.market_data.total_volume.usd?.toLocaleString() || 'N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">All Time High</div>
                                <div class="detail-value">$${coin.market_data.ath.usd?.toLocaleString() || 'N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">All Time Low</div>
                                <div class="detail-value">$${coin.market_data.atl.usd?.toLocaleString() || 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="json-display">
                    <h3>Raw JSON Data:</h3>
                    <pre>${JSON.stringify(coin, null, 2)}</pre>
                </div>
            `;
        }

        function displayTrendingData(data) {
            const container = document.getElementById('data-display');
            
            container.innerHTML = `
                <h2>üî• Trending Cryptocurrencies</h2>
                <div class="crypto-grid">
                    ${data.coins.map(item => `
                        <div class="crypto-card">
                            <div class="crypto-header">
                                <img src="${item.item.large}" alt="${item.item.name}" class="crypto-icon">
                                <div>
                                    <div class="crypto-name">${item.item.name}</div>
                                    <span class="crypto-symbol">${item.item.symbol}</span>
                                </div>
                            </div>
                            <div class="crypto-details">
                                <div class="detail-item">
                                    <div class="detail-label">Market Cap Rank</div>
                                    <div class="detail-value">#${item.item.market_cap_rank}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Score</div>
                                    <div class="detail-value">${item.item.score + 1}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displayGlobalStats(data) {
            const container = document.getElementById('data-display');
            const stats = data.data;
            
            container.innerHTML = `
                <h2>üåç Global Cryptocurrency Statistics</h2>
                <div class="crypto-grid">
                    <div class="crypto-card">
                        <h3>Market Overview</h3>
                        <div class="crypto-details">
                            <div class="detail-item">
                                <div class="detail-label">Active Cryptocurrencies</div>
                                <div class="detail-value">${stats.active_cryptocurrencies?.toLocaleString()}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Markets</div>
                                <div class="detail-value">${stats.markets?.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                    <div class="crypto-card">
                        <h3>Market Cap</h3>
                        <div class="crypto-details">
                            <div class="detail-item">
                                <div class="detail-label">Total Market Cap</div>
                                <div class="detail-value">$${stats.total_market_cap?.usd?.toLocaleString()}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Total Volume (24h)</div>
                                <div class="detail-value">$${stats.total_volume?.usd?.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                    <div class="crypto-card">
                        <h3>Dominance</h3>
                        <div class="crypto-details">
                            <div class="detail-item">
                                <div class="detail-label">Bitcoin Dominance</div>
                                <div class="detail-value">${stats.market_cap_percentage?.btc?.toFixed(2)}%</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ethereum Dominance</div>
                                <div class="detail-value">${stats.market_cap_percentage?.eth?.toFixed(2)}%</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="json-display">
                    <h3>Raw JSON Data:</h3>
                    <pre>${JSON.stringify(coin, null, 2)}</pre>
                    <div id="prediction-output" style="margin-top: 10px;"></div>

                </div>
            `;
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        // Load initial market data
        document.addEventListener('DOMContentLoaded', function() {
            fetchMarketData();
        });
        // Dummy wallet setup
let balance = parseFloat(localStorage.getItem("wallet_balance") || "10000");
let holdings = JSON.parse(localStorage.getItem("wallet_holdings") || "{}");

function updateWalletUI() {
    document.getElementById("wallet-balance").innerText = balance.toFixed(2);
    document.getElementById("wallet-holdings").innerText = JSON.stringify(holdings, null, 2);
    localStorage.setItem("wallet_balance", balance);
    localStorage.setItem("wallet_holdings", JSON.stringify(holdings));
}

async function getCurrentPrice(coinId) {
    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinId}&vs_currencies=usd`);
    const data = await res.json();
    return data[coinId]?.usd || 0;
}

async function buyCoin() {
    const coin = document.getElementById("wallet-coin").value;
    const amount = parseFloat(document.getElementById("wallet-amount").value);
    if (isNaN(amount) || amount <= 0) {
        alert("Enter a valid amount");
        return;
    }

    try {
        const response = await fetch('/buy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ coin: coin, qty: amount })
        });

        const result = await response.json();

        if (!response.ok) {
            alert(result.error || "Buy failed");
            return;
        }

        alert(`Successfully bought ${amount} ${coin}`);
        await refreshWalletFromBackend();
    } catch (error) {
        console.error("Error during buy:", error);
        alert("An error occurred while buying.");
    }
}
async function sellCoin() {
    const coin = document.getElementById("wallet-coin").value;
    const amount = parseFloat(document.getElementById("wallet-amount").value);
    
    if (isNaN(amount) || amount <= 0) {
        alert("Enter a valid amount");
        return;
    }

    try {
        const response = await fetch('/sell', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ coin: coin, qty: amount })
        });

        const result = await response.json();

        if (!response.ok) {
            alert(result.error || "Sell failed");
            return;
        }

        alert(`Successfully sold ${amount} ${coin}`);
        await refreshWalletFromBackend();
    } catch (error) {
        console.error("Error during sell:", error);
        alert("An error occurred while selling.");
    }
}

// Initial UI load
document.addEventListener("DOMContentLoaded", refreshWalletFromBackend);

    async function renderWallet() {
    const container = document.getElementById('wallet-table-container');
    console.log("Holdings:", holdings); // üîç debug log

    if (!container) {
        console.error("wallet-table-container not found");
        return;
    }

    if (!Object.keys(holdings).length) {
        container.innerHTML = "<p>No holdings yet.</p>";
        return;
    }

    let tableHTML = `
        <table style="width:100%; border-collapse: collapse; margin-top: 20px;">
            <thead>
                <tr style="background: #eee;">
                    <th style="padding:10px; border: 1px solid #ccc;">Coin</th>
                    <th style="padding:10px; border: 1px solid #ccc;">Buy Price</th>
                    <th style="padding:10px; border: 1px solid #ccc;">Current Price</th>
                    <th style="padding:10px; border: 1px solid #ccc;">Quantity</th>
                    <th style="padding:10px; border: 1px solid #ccc;">P/L ($)</th>
                </tr>
            </thead>
            <tbody>
    `;

    for (let coin in holdings) {
        const data = holdings[coin];
        if (!data || typeof data !== "object") continue;

        const { qty, buyPrice } = data;
        const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coin}&vs_currencies=usd`);
        const priceData = await res.json();
        const currentPrice = priceData[coin]?.usd || 0;
        const pl = (currentPrice - buyPrice) * qty;
        const color = pl >= 0 ? 'green' : 'red';

        tableHTML += `
            <tr>
                <td style="padding:10px; border: 1px solid #ccc;">${coin}</td>
                <td style="padding:10px; border: 1px solid #ccc;">$${buyPrice.toFixed(2)}</td>
                <td style="padding:10px; border: 1px solid #ccc;">$${currentPrice.toFixed(2)}</td>
                <td style="padding:10px; border: 1px solid #ccc;">${qty}</td>
                <td style="padding:10px; border: 1px solid #ccc; color: ${color};">$${pl.toFixed(2)}</td>
            </tr>
        `;
    }

    tableHTML += "</tbody></table>";
    container.innerHTML = tableHTML;
}



    
async function refreshWalletFromBackend() {
    try {
        const res = await fetch('/wallet');
        const data = await res.json();
        balance = data.balance;
        holdings = data.holdings;
        updateWalletUI();
    } catch (err) {
        console.error("Failed to load wallet data", err);
    }
}
async function predictCoinMovement(coinData) {
    try {
        const res = await fetch("http://localhost:5001/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(coinData)
        });
        const prediction = await res.json();

        const predOutput = document.getElementById("prediction-output");
        if (prediction.error) {
            predOutput.innerHTML = `<p style='color:red;'>Prediction Error: ${prediction.error}</p>`;
        } else {
            const color = prediction.prediction === "up" ? "green" : "red";
            predOutput.innerHTML = `
                <p><strong>Prediction:</strong> <span style="color:${color}; font-weight:bold;">
                ${prediction.prediction.toUpperCase()}</span> &nbsp; | &nbsp;
                <strong>Confidence:</strong> ${(prediction.confidence * 100).toFixed(1)}%</p>
            `;
        }
    } catch (err) {
        document.getElementById("prediction-output").innerHTML =
            `<p style='color:red;'>Failed to fetch prediction: ${err}</p>`;
    }
}


async function predictFromInput() {
    const coinId = document.getElementById("predict-coin-id").value.trim();
    const output = document.getElementById("prediction-result");
    output.style.display = "block";
    output.innerHTML = "‚è≥ Fetching data and predicting...";

    if (!coinId) {
        output.innerHTML = "<p style='color:red;'>Please enter a valid coin ID.</p>";
        return;
    }

    try {
        const predRes = await fetch(`/fetch-and-predict`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: coinId })
});

        const pred = await predRes.json();

        if (pred.error) {
            output.innerHTML = `<p style='color:red;'>Prediction Error: ${pred.error}</p>`;
        } else {
            const color = pred.prediction === "up" ? "green" : "red";
            output.innerHTML = `
                <h3>Prediction Result</h3>
                <p><strong>Prediction:</strong> <span style="color:${color}; font-weight:bold;">${pred.prediction.toUpperCase()}</span></p>
                <p><strong>Confidence:</strong> ${(pred.confidence * 100).toFixed(1)}%</p>
                <p><strong>Suggested Action:</strong> <span style="font-weight:bold; color:${color};">${pred.prediction === "up" ? "BUY" : "SELL"}</span></p>
            `;
        }
    } catch (error) {
        output.innerHTML = `<p style='color:red;'>Error fetching data or predicting: ${error.message}</p>`;
    }
}
</script>
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script>

function loadTradingViewChart(symbol = "BINANCE:BTCUSDT") {
    document.getElementById("tv-chart").innerHTML = "";
    new TradingView.widget({
        "container_id": "tv-chart",
        "width": "100%",
        "height": 600,
        "symbol": symbol,
        "interval": "15",
        "theme": "dark",
        "style": "1",
        "toolbar_bg": "#f1f3f6",
        "locale": "en",
        "autosize": true
    });
}


document.addEventListener("DOMContentLoaded", () => {
  const dropdown = document.getElementById("wallet-coin");
  if (dropdown) {
    dropdown.addEventListener("change", () => {
      const coin = dropdown.value.toLowerCase();  // e.g., "bitcoin"
      const symbolMap = {
        bitcoin: "BINANCE:BTCUSDT",
        ethereum: "BINANCE:ETHUSDT",
        cardano: "BINANCE:ADAUSDT",
        ripple: "BINANCE:XRPUSDT",
        dogecoin: "BINANCE:DOGEUSDT",
        polygon: "BINANCE:MATICUSDT"
      };
      const tvSymbol = symbolMap[coin] || "BINANCE:BTCUSDT";
      loadTradingViewChart(tvSymbol);  // üîÅ auto-update chart
    });
  }
});
</script>



</body>
</html>